/* Copyright (c) 2010 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Version 1.0
 *
 * Contributions by:
 *   - Neil Monroe (neil.monroe[at]gmail.com)
 */
(function(a){a.fn.extend({countable:function(b){return this.each(function(){var h=a(this),e,d,g,f=a.extend({threshold:0.5,appendMethod:"insertAfter",target:h,startOpacity:0.25,maxLength:parseInt(h.attr("maxlength"),10)||0,maxClassName:"maxed",className:"counter",tagName:"span",interval:750,positiveCopy:"You have {n}&nbsp;characters left.",negativeCopy:"You are {n}&nbsp;characters over.",fadeDuration:"normal",defaultText:""},b);g=a("<"+f.tagName+"/>").html(f.positiveCopy.replace("{n}",'<span class="num"></span>')).addClass(f.className);if(a.support.opacity){g.css({opacity:0})}g[f.appendMethod](f.target);h.bind("keyup",c).bind("focus blur",function(i){if(i.type=="blur"){clearInterval(e)}if(i.type=="focus"&&!e){setInterval(c,f.interval)}});function c(){var m=h.val(),l=(m==f.defaultText?0:m.length),i=l/f.maxLength,k=f.maxLength-l,j;if(d!=undefined&&k==d){return}if(g.is(":hidden")&&i>=f.threshold){g.show()}if(g.is(":visible")&&i<f.threshold){g.hide()}if(a.support.opacity){j=f.startOpacity+((f.threshold-i)*((f.startOpacity*2)-2));g.stop().fadeTo(f.fadeDuration,i>=f.threshold?j:0)}if(k>=0){if(g.is("."+f.maxClassName)){g.html(f.positiveCopy.replace("{n}",'<span class="num"></span>'))}}else{if(!g.is("."+f.maxClassName)){g.html(f.negativeCopy.replace("{n}",'<span class="num"></span>'))}}g[(k<0?"add":"remove")+"Class"](f.maxClassName);g.find(".num").text(Math.abs(k));if(k==-1||k==1){g.html(g.html().replace(/characters\b/,"character"))}else{g.html(g.html().replace(/character\b/,"characters"))}d=k}c()})}})})(jQuery);