/**
 * ColdFusion File Manager Plugin for TinyMCE 4
 * updated to support TinyMCE 5 by kartogram
 *
 * Saman W Jayasekara sam@cflove.org
 * Twitter : cfloveorg 
 *
 */
(function () {
    var filemanager = (function () {
        'use strict';
		tinymce.PluginManager.add('filemanager', function(editor, url) {

			if (typeof fileManager != 'undefined') {
				var fileManagerpath = editor.settings.fileManager_path;
			} else {
				var fileManagerpath = 'assets/editors/tinymce/plugins/filemanager/index.cfm'
			}
			
			editor.ui.registry.addIcon('filemanagericon', '<svg height="48" viewBox="0 0 48 48" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h48v48H0z" fill="none"/><path d="M4 12H0v10h.02L0 40c0 2.21 1.79 4 4 4h36v-4H4V12zm40-4H28l-4-4H12C9.79 4 8.02 5.79 8.02 8L8 32c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM14 30l9-12 7 9.01L35 21l7 9H14z"/></svg>');
			
			function showDialog() {
				editor.windowManager.openUrl({ 
					title: 'My Files Home',			
					url: fileManagerpath,
					width: $( window ).width() - 40,
					height: $( window ).height() - 80
				});
			}
			
			// Add a button that opens a window
			editor.ui.registry.addButton('filemanager', {
				tooltip: 'Insert From My Files',
				icon: 'filemanagericon',
				onAction: showDialog
			});
			// Adds a menu item to the tools menu
			editor.ui.registry.addMenuItem('filemanager', {
				text: 'My Files',
				//context: 'insert',
				icon: 'filemanagericon',
				onAction: showDialog
			});
			
			return {
				getMetadata: function () {
				  return {
					name: 'My Files',
					url: fileManagerpath
				  };
				}
			}
		});
	}());
})();